#===========================================================
# template makefile for gaps_server xxxgame.so
# tps_so_template
#===========================================================

###±àÒë±êÖ¾###

C_FLAGS          = -Wall -D_GNU_SOURCE  -Wno-deprecated -fPIC -g -pipe -D_DEBUG -Woverloaded-virtual -Wpointer-arith -fno-strict-aliasing -std=c++0x
CXX_FLAGS        = -Wall -D_GNU_SOURCE  -Wno-deprecated -fPIC -g -pipe -D_DEBUG -Woverloaded-virtual -Wpointer-arith -D__cplusplus -fno-s -std=c++0x

TARGET = ../bin/Game.so
TARGET_HEAD = ../bin/gamehead.so
OBJ_DIR = ./obj/
AR = ar

SOURCE=$(wildcard *.cpp)
SOURCE+=$(wildcard *.c)
SOURCE+=$(wildcard *.cc *.cc)

SRC=$(notdir $(SOURCE))
SRCOBJ=$(patsubst %.cc,%.o,$(patsubst %.c,%.o,$(patsubst %.cpp,%.o,$(SRC))))
OBJS=$(addprefix $(OBJ_DIR), $(SRCOBJ))
INC_GAPSCOMM = -I../include -I./Protocol
LIB_GAPSCOMM = ../lib/libgapscomm.a
LIB_GAPSCOMM_HEAD = ../lib/libpkgheader.a

#æ­¤å¤„é…ç½®é¡¹ç›®ä¾èµ–åº“æŸ¥æ‰¾è·¯å¾„ï¼Œå¦‚-L/usr/local/protobuf34/lib
LIB_PATH = -L../lib/ -L/home/yanling.wu/protobuf34/lib -L.
#æ­¤å¤„å¢åŠ é¡¹ç›®ä¾èµ–å¤´æ–‡ä»¶è·¯å¾„ï¼Œå¦‚-I/usr/local/protobuf34/protobuf
INC = -I./ $(INC_GAPSCOMM) -I../tsf4g/include -I/home/yanling.wu/protobuf34/include
#æ­¤å¤„åœ¨åé¢å¢åŠ é¡¹ç›®ä¾èµ–åº“ï¼Œå¦‚-lprotobuf
LIB = $(LIB_GAPSCOMM) $(LIB_PATH) -lgamecomm -lcomm -lscew -lexpat -lprotobuf

all:$(OBJS)
.PHONY:clean

$(OBJ_DIR)%.o: %.cpp
	@$(CXX) $(INC) $(C_FLAGS) -c $< -o $@ 
	@echo compile   $@ 
$(OBJ_DIR)%.o: %.c
	@$(CC) $(INC) $(C_FLAGS) -c $< -o $@ 
	@echo compile   $@	
$(OBJ_DIR)%.o: %.cc 
	@$(CC) $(INC) $(C_FLAGS) -c $< -o $@ 
	@echo compile   $@	
$(TARGET): $(OBJS)
	@$(AR) x $(LIB_GAPSCOMM)
	@echo $(CXX) $(C_FLAGS) -shared *.o  $^ -o $@ $(LIB) 
	@$(CXX) $(C_FLAGS) -shared *.o  $^ -o $@ $(LIB) 
	@rm *.o
	@echo -e "Create $@"
$(TARGET_HEAD): PkgHead.h PkgHead.cpp
	@$(AR) x $(LIB_GAPSCOMM_HEAD) 
	mv *.o $(OBJ_DIR)
	g++ -Wall -D_GNU_SOURCE -Wno-deprecated -fPIC -g -pipe -D_DEBUG -Woverloaded-virtual -Wpointer-arith -fno-strict-aliasing $(LIB) -shared ./obj/headersoexporter.o ./obj/PkgHead.o ./obj/ProtocolHead.o -o ../bin/gamehead.so ../lib/libpkgheader.a 



all:$(TARGET)
head: $(TARGET_HEAD)
clean:
	@rm -f $(TARGET)  $(OBJS)
	@rm -f ../bin/gamehead.so
	@echo rm $(OBJS)  $(TARGET)
